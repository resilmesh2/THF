Description
What the Plugin DOES Allow

Supported Aggregations:
The Anomaly Detection plugin only supports simple, single-level metric aggregations:
1. Basic Metric Aggregations:
python
# Simple count
"aggregation_query": {
    "total_alerts": {
        "value_count": {
            "field": "_id"
        }
    }
}

# Sum of a field
"aggregation_query": {
    "severity_sum": {
        "sum": {
            "field": "rule.level"
        }
    }
}

# Average of a field
"aggregation_query": {
    "avg_severity": {
        "avg": {
            "field": "rule.level"
        }
    }
}

# Cardinality (unique count)
"aggregation_query": {
    "unique_rules": {
        "cardinality": {
            "field": "rule.id"
        }
    }
}

# Max/Min values
"aggregation_query": {
    "max_severity": {
        "max": {
            "field": "rule.level"
        }
    }
}
2. Simple Filter Aggregations:
python
# Basic filter without sub-aggregations
"aggregation_query": {
    "high_severity_count": {
        "filter": {
            "range": {
                "rule.level": {"gte": 8}
            }
        }
    }
}

1. Threshold Detector (KRgHrZgBvo1LfHnMYrYi)
* Type: SINGLE_ENTITY (global analysis)
* Description: RCF Detector for threshold anomalies in alert volumes and severity
* Purpose: Detects overall anomalies in Wazuh alert patterns
* Features it monitors: 
o total_alerts: Count of all alerts per interval
o severity_sum: Total severity score (sum of rule.level)
o avg_severity: Average severity level
o unique_rules: Number of different rules triggered
* Detection interval: Every 10 minutes

2. Behavioural Detector (PhgHrZgBvo1LfHnMaLYl)
* Type: MULTI_ENTITY (per-host analysis via category_field: ["agent.name"])
* Description: RCF detector for per-host behavioural anomalies
* Purpose: Detects unusual behavior patterns per host
* Features it monitors: 
o host_alert_count: Alert volume per host
o host_severity_sum: Severity score per host
o host_rule_diversity: Rule variety per host
* Detection interval: Every 15 minutes

3. Failed Login Detector (oRgHrZgBvo1LfHnMbraC)
* Type: MULTI_ENTITY (per-host failed login tracking)
* Description: RCF detector for failed login attempts per host
* Purpose: Detects brute force attacks and login anomalies
* Features it monitors: 
o failed_login_count: Failed authentication attempts per host
* Filter: Only processes alerts matching failed login patterns
* Detection interval: Every 5 minutes

4. High Severity Detector (0hgHrZgBvo1LfHnMc7b3)
* Type: SINGLE_ENTITY (global high-severity analysis)
* Description: RCF detector for high severity alert spikes
* Purpose: Detects spikes in critical security alerts
* Features it monitors: 
o high_severity_count: Count of alerts with rule.level ? 8
o max_severity: Highest severity level in the interval
* Filter: Only processes alerts with rule.level >= 8
* Detection interval: Every 5 minutes


